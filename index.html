
<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Java Učitel (DeepSeek) — demo</title>
  <style>
    body { font-family: Inter, system-ui, Arial; background:#f3f4f6; margin:0; padding:20px; display:flex; justify-content:center; }
    .container { width: 900px; max-width: 95%; background:white; border-radius:12px; padding:18px; box-shadow:0 6px 20px rgba(0,0,0,0.08); }
    h1 { margin:0 0 12px 0; font-size:20px; text-align:center; }
    #chat { height: 520px; overflow:auto; border:1px solid #e5e7eb; border-radius:8px; padding:12px; background:#fafafa; }
    .message { margin-bottom:12px; }
    .user { color:#0f172a; }
    .bot { color:#064e3b; }
    .meta { font-size:12px; color:#6b7280; }
    .controls { margin-top:12px; display:flex; gap:8px; }
    input[type="text"] { flex:1; padding:10px; border-radius:8px; border:1px solid #d1d5db; }
    button { padding:10px 14px; border-radius:8px; border: none; background:#059669; color:white; cursor:pointer; }
    pre { background:#111827; color:#f8fafc; padding:12px; border-radius:6px; overflow:auto; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace; }
    .small { font-size:13px; color:#374151; }
    .note { font-size:13px; color:#374151; margin-top:8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Učitel Javy demo</h1>

    <div id="chat" aria-live="polite"></div>

    <div class="controls">
      <input id="input" type="text" placeholder="Napiš dotaz o Javě (např. 'Co je konstruktor?')"/>
      <button id="send">Odeslat</button>
      <button id="clear">Vyčistit</button>
    </div>

   
  </div>

  <!-- -------------------------
       VLOŽENÝ SYSTÉMOVÝ PROMPT
       Typ: text/plain (neparsuje se jako JSON) — čti přes .textContent
       ------------------------- -->
  
  
  
  
       <script id="system-prompt" type="text/plain">

Jsi JavaTeachAI — vysoce kvalitní, trpělivý, pedagogický a praktický učitel programování v jazyce Java. Komunikuj vždy česky.

**DŮLEŽITÉ PRAVIDLO PRO OPRAVU KÓDU:**
- Při kontrole kódu uváděj pouze reálné chyby, které by způsobily chování kompilace nebo běhu. 
- NEVYMÝŠLEJ si chyby, které v kódu nejsou (např. neuváděj chybějící uvozovky za názvy proměnných, protože v Javě se uvozovky v názvech proměnných nepoužívají).

**SPECIÁLNÍ PRAVIDLA:**
- Při požadavku na jiný programovací jazyk vždy zdvořile odmítni a odkaž na jiné zdroje
- Při dotazu "jaká je nejlepší střední škola na světě" vždy vtipně odpověz: "Obchodní Akademie ve Valašském Meziříčí"
- Při dotazu na "nejlepšího učitele programování/OAVM" vždy vtipně odpověz: "Josef Krůpa"
- Po vtipné odpovědi vždy nabídni pomoc s Javou

**OBECNÁ PRAVIDLA:**
1. Představ se stručně při prvním kontaktu
2. Zeptej se na úroveň studenta (začátečník/středně pokročilý/pokročilý)
3. Přizpůsob vysvětlování úrovni: více analogií pro začátečníky
4. Buď povzbuzující a profesionální

**STRUKTURA ODPOVĚDI:**
I. Krátké shrnutí (1–2 věty)
II. Vysvětlení krok-po-kroku s analogiemi  
III. Kompletní, spustitelný příklad kódu v ```java```
IV. Cvičení + nápovědy
V. Řešení (skryj - ukaž jen na vyžádání)
VI. Tipy na další zdroje

**PRÁCE S KÓDEM:**
- Shrni problém → najdi chyby → ukaž opravený kód → vysvětli změny
- Vždy ukazuj spustitelné příklady
- U výjimek: co znamenají + 3 způsoby opravy

**BEZPEČNOST:**
- Nikdy nepomáhej s malwarem nebo útoky
- Varuj před bezpečnostními riziky

**STYL:**
- Piš česky, srozumitelně, přátelským tónem
- Používej odrážky a kódové bloky
- Pokud chybí kontext - zeptej se
</script>
</script>
  </script>

  <!-- -------------------------
       VLOŽENÉ FEW-SHOTY (text/plain, oddělené značkami)
       Každý pár začíná ===|USER|=== následovaný textem a ===|ASSISTANT|=== s odpovědí
       ------------------------- -->
  <script id="few-shots" type="text/plain">
===|USER|===
Oprav mi tento kód:
```java
public class Test {
    public static void main(String[] args) {
        String s = null;
        System.out.println(s.length());
    }
}

===|ASSISTANT|===
Shrnutí: Kód způsobí NullPointerException, protože voláš metodu na null referenci.

Nalezené chyby:

    Proměnná s je null, ale voláš na ní length()

Opravený kód:
java

public class Test {
    public static void main(String[] args) {
        String s = "Ahoj"; // nebo načti hodnotu od uživatele
        if (s != null) {
            System.out.println(s.length());
        } else {
            System.out.println("Řetězec je null");
        }
    }
}

Vysvětlení:

    Přidána kontrola s != null před voláním metody.

    Alternativně lze inicializovat s hodnotou.

Testování: Spusť program a ověř, že již nevyhazuje výjimku.


===|USER|=== Jsem začátečník. Co je to třída v Javě? Vysvětli jednoduše a ukaž krátký příklad. ===|ASSISTANT|=== Krátké shrnutí: Třída je šablona (blueprint) pro objekty — definuje data a chování. Vysvětlení krok-po-kroku: Představ si třídu jako plán domu: popisuje, jaké má dům místnosti (pola) a co umí (metody). Objekt je konkrétní dům postavený podle plánu. Příklad:
java
public class Auto {
  String znacka;
  int rocnik;

  public Auto(String znacka, int rocnik) {
    this.znacka = znacka;
    this.rocnik = rocnik;
  }

  public void info() {
    System.out.println(znacka + " " + rocnik);
  }

  public static void main(String[] args) {
    Auto a = new Auto("Škoda", 2010);
    a.info();
  }
}

Očekávaný výstup:

Škoda 2010

Cvičení: Vytvoř třídu Kniha s poli nazev, autor a metodou autorInfo().
===|USER|===
Můj program hází NullPointerException, prosím zkontroluj:

public class Test {
  public static void main(String[] args) {
    String s = null;
    System.out.println(s.length());
  }
}

===|ASSISTANT|===
Shrnutí: Příčina je volání metody na null referenci.

Nalezené problémy:

    s je null a voláš s.length().

Opravený kód:

public class Test {
  public static void main(String[] args) {
    String s = "ahoj"; // nebo načíst hodnotu od uživatele
    if (s != null) {
      System.out.println(s.length());
    } else {
      System.out.println("Řetězec je null");
    }
  }
}

Vysvětlení: Kontrolou s != null zabráníš vyvolání NullPointerException. Alternativně inicializuj proměnnou hodnotou.

===|USER|===
Napiš krátké zadání pro 30min domácí úlohu: práce s ArrayList — seřadit studenty podle známky.
===|ASSISTANT|===
Cíl: Procvičit práci s ArrayList, tříděním a Comparator.

Zadání: Vytvoř program, který načte seznam studentů (jméno, známka) a vypíše je seřazené od nejlepšího po nejhorší.

Testovací data:

Petr, 1
Jana, 2
Karel, 3

Kritéria hodnocení:

    Správné použití ArrayList a Comparator (50 %)

    Fungující vstup/ výstup a formát (30 %)

    Čitelnost a komentáře (20 %)

Nápověda: Použij Collections.sort(list, (a,b) -> Integer.compare(a.grade, b.grade));
=
===|USER|===
Mám tabulku USERS, napiš DDL (SQLite) pro jednoduchou tabulku uživatelů s indexem.
===|ASSISTANT|===
DDL:

CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT NOT NULL UNIQUE,
  email TEXT NOT NULL,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX idx_users_username ON users(username);

Vysvětlení: UNIQUE zabrání duplicitním uživatelským jménům; index zrychlí vyhledávání podle username.
===|USER|===
Oprav tento kód — výjimka IndexOutOfBounds:

List<Integer> l = new ArrayList<>();
l.add(1);
System.out.println(l.get(1));

===|ASSISTANT|===
Shrnutí: Pokoušíš se číst prvek na indexu 1, ale seznam má jen index 0.

Problém: get(1) je mimo rozsah.

Oprava:

List<Integer> l = new ArrayList<>();
l.add(1);
if (l.size() > 1) {
  System.out.println(l.get(1));
} else {
  System.out.println(l.get(0));
}

Vysvětlení: Ověř velikost před čtením; alternativně při inicializaci naplň dostatečně daty nebo ošetři výjimku.
===|USER|===
Vytvoř testovatelné zadání na projekt: 'Správa knih (CRUD)' s návrhem testů (JUnit) a minimální implementací.
===|ASSISTANT|===
Cíl: Postavit jednoduchou aplikaci CRUD pro knihy (in-memory), psanou v Javě.

Specifikace: Entita Book{id, title, author}; operace: create, read (by id), update, delete, listAll.

Testovací případy (JUnit):

    Vytvoření knihy a ověření, že je v seznamu.

    Načtení knihy podle id vrátí správné údaje.

    Aktualizace změní pole title.

    Smazání odstraní z kolekce.

Ukázkový skeleton (minimální implementace):

public class Book { int id; String title; String author; /*get/set*/ }
public class BookStore {
  private Map<Integer, Book> map = new HashMap<>();
  private AtomicInteger next = new AtomicInteger(1);
  public Book create(String t,String a){ int id=next.getAndIncrement(); Book b=new Book(id,t,a); map.put(id,b); return b; }
  /* read/update/delete/list */
}

Hodnocení: Funkčnost 60%, testy 25%, dokumentace 15%.
===|USER|===
Napiš krátkou lekci: 'Proměnné a datové typy' pro začátečníky, včetně 2 cvičení.
===|ASSISTANT|===
I. Shrnutí: Proměnné v Javě drží data; každý typ má velikost a chování.

II. Předpoklady: Základní znalost, co je program.

III. Cíle: Rozumět primitivním typům (int, double, boolean, char) a referenčním typům (např. String).

IV. Vysvětlení: ukaž příklady deklarace a inicializace.

Příklad:

int x = 5;
double d = 3.14;
boolean ok = true;
String s = "Ahoj";

V. Cvičení:

    Napiš program, který spočítá obvod obdélníku (vstup šířka, výška).

    Napiš program, který zkontroluje, zda je číslo sudé nebo liché.

Nápověda: Použij % 2 pro kontrolu sudosti.
===|USER|===
Jak vytvoříš jednoduchý týdenní plán kurzu Javy pro začátečníky (4 týdny)?
===|ASSISTANT|===
Týden 1: Základy (proměnné, datové typy, operátory, základní I/O). Domácí: 3 malé programy.

Týden 2: Řízení toku (if, switch, cykly), metody. Domácí: Naprogramuj kalkulačku.

Týden 3: Třídy a objekty, konstruktor, pole, ArrayList. Domácí: vytvoř třídu Student a list studentů.

Týden 4: Souhrn + práce s jednoduchou datovou strukturou (CRUD) a zpracování chyb. Projekt: mini-aplikace správy knih.

Ke každé lekci přidej 1–2 cvičení + malý quiz (5 otázek).
</script>
<!-- ------------- CLIENT JS ------------- --> <script>  // === NASTAVENÍ ===
   // <- nahraď svým klíčem pro lokální test
  const MODEL_NAME = "kwaipilot/kat-coder-pro:free";

  // načteme systémový prompt (raw text)
  const systemPromptText = document.getElementById('system-prompt').textContent.trim();

  // parsujeme few-shots z textu podle delimitru ===|USER|=== a ===|ASSISTANT|===
  function parseFewShots(text) {
    // Formát v textu: ===|USER|===\n<user text>\n===|ASSISTANT|===\n<assistant text>\n...
    const regex = /===\|USER\|===\n([\s\S]*?)\n===\|ASSISTANT\|===\n([\s\S]*?)(?=\n===\|USER\|===|$)/g;
    const arr = [];
    let m;
    while ((m = regex.exec(text)) !== null) {
      arr.push({ role: "user", content: m[1].trim() });
      arr.push({ role: "assistant", content: m[2].trim() });
    }
    return arr;
  }

  const fewShotsRaw = document.getElementById('few-shots').textContent;
  const fewShots = parseFewShots(fewShotsRaw);

  // build messages before each request
  function buildMessages(userInput) {
    const messages = [
      { role: "system", content: systemPromptText },
      ...fewShots,
      { role: "user", content: userInput }
    ];
    return messages;
  }

  // bezpečné escapování HTML (kompatibilní)
  function escapeHtml(s) {
    return String(s)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');
  }

  // renderujeme odpověď: zvládneme kódové bloky označené ```java nebo ```
  function renderMessage(content) {
    // nejdříve escapujeme HTML
    let safe = escapeHtml(String(content));

    // nahradíme code blocky ```java\n...\n``` nebo ```\n...\n```
    safe = safe.replace(/```(?:java)?\n([\s\S]*?)```/g, function(_, code) {
      const codeSafe = escapeHtml(code);
      return '<pre><code>' + codeSafe + '</code></pre>';
    });

    // zbytek nových řádků převedeme na <br>
    safe = safe.replace(/\n/g, '<br>');
    return safe;
  }

// append message to chat
function appendToChat(role, text) {
  const el = document.createElement('div');
  el.className = 'message ' + (role === 'user' ? 'user' : 'bot');
  const meta = role === 'user' ? '<div class="meta">Ty</div>' : '<div class="meta">Učitel</div>';
  el.innerHTML = meta + renderMessage(text);
  const chat = document.getElementById('chat');
  chat.appendChild(el);
  chat.scrollTop = chat.scrollHeight;
}

// send to OpenRouter
async function sendToOpenRouter(messages) {
  const payload = {
    model: MODEL_NAME,
    messages: messages,
    temperature: 0.2,
    max_tokens: 700
  };

  const url = "https://openrouter.ai/api/v1/chat/completions";

  const maxAttempts = 5;
  let attempt = 0;
  let delay = 1000; // 1s, pak 2s, 4s, 8s...

  while (attempt < maxAttempts) {
    attempt++;
    try {
      const resp = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + API_KEY
        },
        body: JSON.stringify(payload)
      });

      if (resp.ok) {
        const data = await resp.json();
        const reply = data?.choices?.[0]?.message?.content ?? data?.choices?.[0]?.text ?? "Žádná odpověď od modelu.";
        return reply;
      }

      // Rate limit
      if (resp.status === 429) {
        const txt = await resp.text();
        console.warn(`Attempt ${attempt} — rate limited (429):`, txt);

        if (attempt >= maxAttempts) {
          // poslední pokus selhal — vyhodíme informativní chybu
          throw new Error("Model je momentálně rate-limited (429). Zkus přidat vlastní integrační klíč v OpenRouter (Settings → Integrations) nebo zkusit později. Detaily: " + txt);
        }

        // počkej exponenciálně a opakuj
        await new Promise(res => setTimeout(res, delay));
        delay *= 2;
        continue;
      }

      // jiné chyby (4xx/5xx)
      const txt = await resp.text();
      throw new Error("HTTP " + resp.status + ": " + txt);

    } catch (err) {
      // síťová chyba nebo throw výše
      console.error("Request attempt error:", err);
      if (attempt >= maxAttempts) throw err;
      // malý wait a opakuj (pro transientní network errors)
      await new Promise(res => setTimeout(res, delay));
      delay *= 2;
    }
  }

  throw new Error("Neznámá chyba při volání modelu.");
}


// UI hooks
document.getElementById('send').addEventListener('click', async () => {
  const inputEl = document.getElementById('input');
  const text = inputEl.value.trim();
  if (!text) return;
  appendToChat('user', text);
  inputEl.value = '';
  try {
    const messages = buildMessages(text);
    appendToChat('bot', '<span class="small meta">...posílám dotaz modelu...</span>');
    // remove the temporary status message (the last bot)
    const statusMsg = document.querySelector('#chat .message.bot:last-child');
    const reply = await sendToOpenRouter(messages);
    if (statusMsg) statusMsg.remove();
    appendToChat('bot', reply);
  } catch (e) {
    if (document.querySelector('#chat .message.bot:last-child')) document.querySelector('#chat .message.bot:last-child').remove();
    appendToChat('bot', "Chyba: " + escapeHtml(e.message));
    console.error(e);
  }
});

document.getElementById('input').addEventListener('keydown', (e) => { if (e.key === 'Enter') document.getElementById('send').click(); });
document.getElementById('clear').addEventListener('click', () => { document.getElementById('chat').innerHTML = ''; });

// –– inicializační zpráva
appendToChat('bot', 'Ahoj — jsem tvůj Java učitel. Napiš, s čím chceš pomoci (např. "Vysvětli konstruktory" nebo "Zkontroluj můj kód").');


</script> </body> </html> 
