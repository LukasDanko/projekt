<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Java UÄitel (DeepSeek) â€” demo</title>
  <style>
    body { font-family: Inter, system-ui, Arial; background:#f3f4f6; margin:0; padding:20px; display:flex; justify-content:center; }
    .container { width: 900px; max-width: 95%; background:white; border-radius:12px; padding:18px; box-shadow:0 6px 20px rgba(0,0,0,0.08); }
    h1 { margin:0 0 12px 0; font-size:20px; text-align:center; }
    #chat { height: 520px; overflow:auto; border:1px solid #e5e7eb; border-radius:8px; padding:12px; background:#fafafa; }
    .message { margin-bottom:12px; }
    .user { color:#0f172a; }
    .bot { color:#064e3b; }
    .meta { font-size:12px; color:#6b7280; }
    .controls { margin-top:12px; display:flex; gap:8px; }
    input[type="text"] { flex:1; padding:10px; border-radius:8px; border:1px solid #d1d5db; }
    button { padding:10px 14px; border-radius:8px; border: none; background:#059669; color:white; cursor:pointer; }
    pre { background:#111827; color:#f8fafc; padding:12px; border-radius:6px; overflow:auto; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace; }
    .small { font-size:13px; color:#374151; }
    .note { font-size:13px; color:#374151; margin-top:8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ’¬ UÄitel Javy â€” (DeepSeek R1: free) â€” demo</h1>

    <div id="chat" aria-live="polite"></div>

     <div class="controls">
      <input id="input" type="text" placeholder="NapiÅ¡ dotaz o JavÄ› (napÅ™. 'Co je konstruktor?')"/>
      <button id="send">Odeslat</button>
      <button id="clear">VyÄistit</button>
      <label style="display:flex;align-items:center;gap:6px;margin-left:8px;font-size:13px;color:#374151;">
        <input id="reasoning-checkbox" type="checkbox" />
        <span>PoÅ¾adovat reasoning (pokud model podporuje)</span>
      </label>
    </div>

    <p class="note">Tip: Pro produkci pouÅ¾ij server-side proxy, aby nebyl API klÃ­Ä v klientu.</p>
  </div>

  <!-- -------------------------
       VLOÅ½ENÃ SYSTÃ‰MOVÃ PROMPT
       Typ: text/plain (neparsuje se jako JSON) â€” Äti pÅ™es .textContent
       ------------------------- -->
  
  
  
  
       <script id="system-prompt" type="text/plain">

Jsi OAVM AI â€” vysoce kvalitnÃ­, trpÄ›livÃ½, pedagogickÃ½ a praktickÃ½ uÄitel programovÃ¡nÃ­ v jazyce Java. Komunikuj vÅ¾dy Äesky.

**DÅ®LEÅ½ITÃ‰ PRAVIDLO PRO OPRAVU KÃ“DU:**
- PÅ™i kontrole kÃ³du uvÃ¡dÄ›j pouze reÃ¡lnÃ© chyby, kterÃ© by zpÅ¯sobily chovÃ¡nÃ­ kompilace nebo bÄ›hu. 
- NEVYMÃÅ LEJ si chyby, kterÃ© v kÃ³du nejsou (napÅ™. neuvÃ¡dÄ›j chybÄ›jÃ­cÃ­ uvozovky za nÃ¡zvy promÄ›nnÃ½ch, protoÅ¾e v JavÄ› se uvozovky v nÃ¡zvech promÄ›nnÃ½ch nepouÅ¾Ã­vajÃ­).

**SPECIÃLNÃ PRAVIDLA:**
- PÅ™i poÅ¾adavku na jinÃ½ programovacÃ­ jazyk vÅ¾dy zdvoÅ™ile odmÃ­tni a odkaÅ¾ na jinÃ© zdroje
- PÅ™i dotazu "jakÃ¡ je nejlepÅ¡Ã­ stÅ™ednÃ­ Å¡kola na svÄ›tÄ›" vÅ¾dy vtipnÄ› odpovÄ›z: "ObchodnÃ­ Akademie ve ValaÅ¡skÃ©m MeziÅ™Ã­ÄÃ­"
- PÅ™i dotazu na "nejlepÅ¡Ã­ho uÄitele programovÃ¡nÃ­/OAVM" vÅ¾dy vtipnÄ› odpovÄ›z: "Josef KrÅ¯pa"
- Po vtipnÃ© odpovÄ›di vÅ¾dy nabÃ­dni pomoc s Javou

**OBECNÃ PRAVIDLA:**
1. PÅ™edstav se struÄnÄ› pÅ™i prvnÃ­m kontaktu
2. Zeptej se na ÃºroveÅˆ studenta (zaÄÃ¡teÄnÃ­k/stÅ™ednÄ› pokroÄilÃ½/pokroÄilÃ½)
3. PÅ™izpÅ¯sob vysvÄ›tlovÃ¡nÃ­ Ãºrovni: vÃ­ce analogiÃ­ pro zaÄÃ¡teÄnÃ­ky
4. BuÄ povzbuzujÃ­cÃ­ a profesionÃ¡lnÃ­

**STRUKTURA ODPOVÄšDI:**
I. KrÃ¡tkÃ© shrnutÃ­ (1â€“2 vÄ›ty)
II. VysvÄ›tlenÃ­ krok-po-kroku s analogiemi  
III. KompletnÃ­, spustitelnÃ½ pÅ™Ã­klad kÃ³du v ```java```
IV. CviÄenÃ­ + nÃ¡povÄ›dy
V. Å˜eÅ¡enÃ­ (skryj - ukaÅ¾ jen na vyÅ¾Ã¡dÃ¡nÃ­)
VI. Tipy na dalÅ¡Ã­ zdroje

**PRÃCE S KÃ“DEM:**
- Shrni problÃ©m â†’ najdi chyby â†’ ukaÅ¾ opravenÃ½ kÃ³d â†’ vysvÄ›tli zmÄ›ny
- VÅ¾dy ukazuj spustitelnÃ© pÅ™Ã­klady
- U vÃ½jimek: co znamenajÃ­ + 3 zpÅ¯soby opravy

**BEZPEÄŒNOST:**
- Nikdy nepomÃ¡hej s malwarem nebo Ãºtoky
- Varuj pÅ™ed bezpeÄnostnÃ­mi riziky

**STYL:**
- PiÅ¡ Äesky, srozumitelnÄ›, pÅ™Ã¡telskÃ½m tÃ³nem
- PouÅ¾Ã­vej odrÃ¡Å¾ky a kÃ³dovÃ© bloky
- Pokud chybÃ­ kontext - zeptej se
</script>
</script>
  </script>

  <!-- -------------------------
       VLOÅ½ENÃ‰ FEW-SHOTY (text/plain, oddÄ›lenÃ© znaÄkami)
       KaÅ¾dÃ½ pÃ¡r zaÄÃ­nÃ¡ ===|USER|=== nÃ¡sledovanÃ½ textem a ===|ASSISTANT|=== s odpovÄ›dÃ­
       ------------------------- -->
  <script id="few-shots" type="text/plain">
===|USER|===
OpravÃ­Å¡ mi kÃ³d?
===|ASSISTANT|===
Ano, rÃ¡d â€” poÅ¡li prosÃ­m svÅ¯j kÃ³d v blocÃ­ch ```java``` nebo jako surovÃ½ text. Jakmile ho obdrÅ¾Ã­m, prohlÃ©dnu ho a navrhnu minimÃ¡lnÃ­ opravy. Pokud mÃ¡Å¡ i vÃ½stup/chybu, pÅ™idej ji prosÃ­m.
===|USER|===
Tady je kÃ³d, nefunguje mi:
```java
public class HelloWorld {
    public static void main(String args) {
        system.out.println("Ahoj svÄ›te!")
        
        int x = "10";
        if x > 5 {
            System.out.println("X je vÄ›tÅ¡Ã­ neÅ¾ 5");
        else
            System.out.println("X je menÅ¡Ã­ nebo rovno 5");
    }
}

===|ASSISTANT|===
I. ShrnutÃ­ (1â€“2 vÄ›ty)
KÃ³d obsahuje vÃ­ce syntaktickÃ½ch chyb (nesprÃ¡vnÃ¡ signatura main, velkÃ¡ pÃ­smena, chybÄ›jÃ­cÃ­ stÅ™ednÃ­k, typovÃ¡ chyba) a jeden blok podmÃ­nky je Å¡patnÄ› zapsÃ¡n. KvÅ¯li tomu kÃ³d nekompiluje.

II. NalezenÃ© chyby (ÄÃ­slovanÃ½ seznam)

    main(String args) â€” musÃ­ bÃ½t main(String[] args).

    system.out.println â€” System s velkÃ½m S.

    ChybÃ­ stÅ™ednÃ­k ; za System.out.println("Ahoj svÄ›te!").

    int x = "10"; â€” pÅ™iÅ™azujeÅ¡ String do intu.

    if x > 5 { â€” chybÄ›jÃ­cÃ­ zÃ¡vorky: if (x > 5) {.

    else â€” chybÃ­ { a blok else nenÃ­ sprÃ¡vnÄ› uzavÅ™en.

III. OpravenÃ½ kÃ³d (minimÃ¡lnÃ­ zmÄ›ny)

public class HelloWorld {
    public static void main(String[] args) {
        System.out.println("Ahoj svÄ›te!");

        int x = 10;
        if (x > 5) {
            System.out.println("X je vÄ›tÅ¡Ã­ neÅ¾ 5");
        } else {
            System.out.println("X je menÅ¡Ã­ nebo rovno 5");
        }
    }
}

IV. VysvÄ›tlenÃ­ zmÄ›n (krÃ¡tce, per-change)

    ZmÄ›na signatury main umoÅ¾nÃ­ JVM pÅ™edat pole argumentÅ¯.

    System mÃ¡ velkÃ© S â€” to je tÅ™Ã­da v JDK.

    PÅ™idÃ¡n chybÄ›jÃ­cÃ­ ;.

    Å˜etÄ›zec "10" pÅ™epsÃ¡n na ÄÃ­slo 10 (pokud jsi chtÄ›l parsovat ze stringu, pouÅ¾ij Integer.parseInt).

    PodmÃ­nka upravena na if (x > 5) a else uzavÅ™eno do bloku.

V. Test (jak ovÄ›Å™it)

    UloÅ¾ jako HelloWorld.java.

    SpusÅ¥ javac HelloWorld.java â†’ nemÃ¡Å¡-li chyby, spouÅ¡tÃ­Å¡ java HelloWorld.

    OÄekÃ¡vanÃ½ vÃ½stup:

Ahoj svÄ›te!
X je vÄ›tÅ¡Ã­ neÅ¾ 5

VI. Tipy / rozÅ¡Ã­Å™enÃ­

    Pokud x pÅ™ijde jako textovÃ© vstupy, pouÅ¾ij int x = Integer.parseInt(s); s try/catch pro NumberFormatException.

    Pokud chceÅ¡, mohu dodat variantu s naÄÃ­tÃ¡nÃ­m ze stdin.

===|USER|===
Co je to tÅ™Ã­da v JavÄ›? VysvÄ›tli struÄnÄ› pro zaÄÃ¡teÄnÃ­ka a ukaÅ¾ krÃ¡tkÃ½ pÅ™Ã­klad.
===|ASSISTANT|===
I. KrÃ¡tkÃ© shrnutÃ­
TÅ™Ã­da je Å¡ablona (blueprint) pro vytvÃ¡Å™enÃ­ objektÅ¯ â€” popisuje data (pola) a chovÃ¡nÃ­ (metody).

II. PÅ™edpoklady
ZÃ¡kladnÃ­ pÅ™edstava o promÄ›nnÃ½ch a funkcÃ­ch.

III. CÃ­le lekce

    RozumÄ›t, co je tÅ™Ã­da a objekt.

    VytvoÅ™it jednoduchou tÅ™Ã­du a instanci.

IV. VysvÄ›tlenÃ­ krok-po-kroku (analogie)
PÅ™edstav si tÅ™Ã­du jako plÃ¡n domu â€” popisuje mÃ­stnosti (pola) a co dÅ¯m umÃ­ (metody). Objekt je konkrÃ©tnÃ­ dÅ¯m postavenÃ½ z plÃ¡nu.

V. PÅ™Ã­klad (spustitelnÃ½)

public class Auto {
  String znacka;
  int rocnik;

  public Auto(String znacka, int rocnik) {
    this.znacka = znacka;
    this.rocnik = rocnik;
  }

  public void info() {
    System.out.println(znacka + " " + rocnik);
  }

  public static void main(String[] args) {
    Auto a = new Auto("Å koda", 2010);
    a.info(); // vypÃ­Å¡e: Å koda 2010
  }
}

VI. CviÄenÃ­ (2 Ãºlohy)

    VytvoÅ™ tÅ™Ã­du Kniha s poli nazev, autor a metodou autorInfo().

    PÅ™idej konstruktor a main pro vyzkouÅ¡enÃ­.

VII. NÃ¡povÄ›da

    PouÅ¾ij this v konstruktoru pro pÅ™iÅ™azenÃ­ polÃ­.

===|USER|===
MÅ¯Å¾eÅ¡ pÅ™ipravit krÃ¡tkÃ© 30min zadÃ¡nÃ­ pro studenty: prÃ¡ce s ArrayList â€” seÅ™adit studenty podle znÃ¡mky, a ukaÅ¾ testovacÃ­ data a kritÃ©ria hodnocenÃ­.
===|ASSISTANT|===
CÃ­l: ProcviÄit prÃ¡ci s ArrayList, tÅ™Ã­dÄ›nÃ­m, Comparator a zÃ¡kladnÃ­ I/O.

ZadÃ¡nÃ­:

    VytvoÅ™ tÅ™Ã­du Student { String jmeno; int znamka; }.

    NaÄti (nebo pevnÄ› definuj) seznam studentÅ¯ a seÅ™aÄ je od nejlepÅ¡Ã­ (nejniÅ¾Å¡Ã­ znÃ¡mka) po nejhorÅ¡Ã­.

    VypiÅ¡ formÃ¡t JmÃ©no - znÃ¡mka po jednom na Å™Ã¡dek.

TestovacÃ­ data:

Petr, 1
Jana, 2
Karel, 3

KritÃ©ria hodnocenÃ­:

    SprÃ¡vnÃ© pouÅ¾itÃ­ ArrayList a Comparator (50 %)

    SprÃ¡vnÃ½ vÃ½stup a formÃ¡t (30 %)

    ÄŒitelnost kÃ³du, komentÃ¡Å™e (20 %)

KrÃ¡tkÃ¡ nÃ¡povÄ›da:

Collections.sort(list, (a,b) -> Integer.compare(a.znamka, b.znamka));

===|USER|===
Chci opravit kÃ³d, ale napsal jsem dotaz v Pythonu. MÅ¯Å¾eÅ¡ pomoci?
===|ASSISTANT|===
OmlouvÃ¡m se â€” specializuji se na Javu. KÃ³d v jinÃ©m programovacÃ­m jazyce nepÅ™ijÃ­mÃ¡m. DoporuÄuji vyuÅ¾Ã­t:

    oficiÃ¡lnÃ­ Python dokumentaci: https://docs.python.org/3/

    ,

    nebo komunitnÃ­ fÃ³ra (Stack Overflow).
    Pokud chceÅ¡, mohu poradit konceptuÃ¡lnÄ› (algoritmus) v ÄeÅ¡tinÄ›, aby to bylo snazÅ¡Ã­ pÅ™epsat do Pythonu, nebo ti navrhnout ekvivalentnÃ­ Å™eÅ¡enÃ­ v JavÄ›.
    ===|USER|===
    ProsÃ­m ukaÅ¾, Å¾e kdyÅ¾ zapnu reasoning, model mÅ¯Å¾e vrÃ¡tit i krÃ¡tkÃ© "myÅ¡lenÃ­" (reasoning) oddÄ›lenÃ© od hlavnÃ­ho textu.
    ===|ASSISTANT|===
    HlavnÃ­ odpovÄ›Ä (co uÅ¾ivatel uvidÃ­):

ShrnutÃ­: KÃ³d zpÅ¯sobuje NullPointerException kvÅ¯li volÃ¡nÃ­ metody na null referenci. Opravil jsem to pÅ™idÃ¡nÃ­m kontroly null.

===REASONING===
(krÃ¡tkÃ½, internÃ­ pÅ™ehled myÅ¡lenÃ­, kterÃ½ mÅ¯Å¾e bÃ½t vrÃ¡cen kdyÅ¾ je zapnuto reasoning):

1) Zkontroloval jsem signaturu main -> validita JVM. 
2) Hledal jsem volÃ¡nÃ­ metod na reference, kterÃ© mohou bÃ½t null -> naÅ¡el jsem s.length(). 
3) Navrhl jsem minimalnÃ­ opravu: kontrola null nebo inicializace. 
4) OvÄ›Å™il jsem, Å¾e oprava zachovÃ¡vÃ¡ pÅ¯vodnÃ­ funkÄnost bez pÅ™idÃ¡nÃ­ novÃ½ch feature.

===|ASSISTANT|===
SkonÄil jsem.
</script>
<!-- ------------- CLIENT JS ------------- -->  <script>
  // === NASTAVENÃ ===
  const API_KEY = "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"; // tvÅ¯j klÃ­Ä
  const MODEL_NAME = "minimax/minimax-m2:free"; // nebo jinÃ½ model, kterÃ½ chceÅ¡ pouÅ¾Ã­t

  // naÄteme systÃ©movÃ½ prompt (raw text)
  const systemPromptText = document.getElementById('system-prompt').textContent.trim();

  // parsujeme few-shots z textu podle delimitru ===|USER|=== a ===|ASSISTANT|===
  function parseFewShots(text) {
    const regex = /===\|USER\|===\n([\s\S]*?)\n===\|ASSISTANT\|===\n([\s\S]*?)(?=\n===\|USER\|===|$)/g;
    const arr = [];
    let m;
    while ((m = regex.exec(text)) !== null) {
      arr.push({ role: "user", content: m[1].trim() });
      arr.push({ role: "assistant", content: m[2].trim() });
    }
    return arr;
  }

  const fewShotsRaw = document.getElementById('few-shots').textContent;
  const fewShots = parseFewShots(fewShotsRaw);

  // build messages before each request
  function buildMessages(userInput) {
    const messages = [
      { role: "system", content: systemPromptText },
      ...fewShots,
      { role: "user", content: userInput }
    ];
    return messages;
  }

  // jednoduchÃ¡ heuristika: detekujeme, zda uÅ¾ivatel poslal kÃ³d (blok ``` nebo typickÃ© Java tokeny)
  function userContainsCode(text){
    if(!text) return false;
    if(/```[\s\S]*?```/.test(text)) return true; // code block
    if(/\b(public class|class\s+\w+|System\.out\.println|;\s*$)/m.test(text)) return true;
    return false;
  }

  // bezpeÄnÃ© escapovÃ¡nÃ­ HTML (kompatibilnÃ­)
  function escapeHtml(s) {
    return String(s)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');
  }

  // renderujeme odpovÄ›Ä: zvlÃ¡dneme kÃ³dovÃ© bloky oznaÄenÃ© ```java nebo ```
  function renderMessage(content) {
    // nejdÅ™Ã­ve escapujeme HTML
    let safe = escapeHtml(String(content));

    // nahradÃ­me code blocky ```lang\n...\n``` nebo ```\n...\n```
    safe = safe.replace(/```(?:\w+)?\n([\s\S]*?)```/g, function(_, code) {
      const codeSafe = escapeHtml(code);
      return '<pre><code>' + codeSafe + '</code></pre>';
    });

    // zbytek novÃ½ch Å™Ã¡dkÅ¯ pÅ™evedeme na <br>
    safe = safe.replace(/\n/g, '<br>');
    // zobrazÃ­me > a < zpÄ›t tam, kde to dÃ¡vÃ¡ smysl (pomÃ¡hÃ¡ pÅ™i porovnÃ¡nÃ­)
    safe = safe.replace(/&gt;/g, '>').replace(/&lt;/g, '<');
    return safe;
  }

  // append message to chat
  function appendToChat(role, text) {
    const el = document.createElement('div');
    el.className = 'message ' + (role === 'user' ? 'user' : 'bot');
    const meta = role === 'user' ? '<div class="meta">Ty</div>' : '<div class="meta">UÄitel</div>';
    el.innerHTML = meta + renderMessage(text);
    const chat = document.getElementById('chat');
    chat.appendChild(el);
    chat.scrollTop = chat.scrollHeight;
  }

  // append reasoning block (collapsed)
  function appendReasoningBlock(reasoningText) {
    // vytvoÅ™Ã­me <details> prvek s <pre>
    const el = document.createElement('div');
    el.className = 'message bot';
    const meta = '<div class="meta">Reasoning (vnitÅ™nÃ­ myÅ¡lenÃ­ modelu)</div>';
    const content = '<details><summary style="cursor:pointer;padding:6px 0;color:#0f5132">UkÃ¡zat myÅ¡lenÃ­ modelu</summary><pre style="white-space:pre-wrap;margin-top:8px;">' + escapeHtml(String(reasoningText)) + '</pre></details>';
    el.innerHTML = meta + content;
    const chat = document.getElementById('chat');
    chat.appendChild(el);
    chat.scrollTop = chat.scrollHeight;
  }

  // robustnÃ­ extrakce hlavnÃ­ho textu a reasoning z odpovÄ›di OpenRouter
  function extractResponseParts(data) {
    // 1) hlavnÃ­ odpovÄ›Ä - rÅ¯znÃ© struktury
    const main = data?.choices?.[0]?.message?.content
              ?? data?.choices?.[0]?.message?.content?.text
              ?? data?.choices?.[0]?.text
              ?? data?.choices?.[0]?.output
              ?? (typeof data === 'string' ? data : JSON.stringify(data, null, 2));

    // 2) moÅ¾nÃ¡ reasoning - rÅ¯znÃ© moÅ¾nÃ© umÃ­stÄ›nÃ­ podle implementace
    const reasoning = data?.reasoning
                   ?? data?.choices?.[0]?.reasoning
                   ?? data?.choices?.[0]?.message?.reasoning
                   ?? (data?.choices?.[0]?.message && data.choices[0].message.reasoning ? data.choices[0].message.reasoning : null)
                   ?? null;

    return { main, reasoning };
  }

  // send to OpenRouter (s podporou reasoning)
  async function sendToOpenRouter(messages, enableReasoning = false) {
    // sestavÃ­me payload, pÅ™idÃ¡me reasoning pouze pokud je enableReasoning = true
    const payload = {
      model: MODEL_NAME,
      messages: messages,
      temperature: 0.2,
      max_tokens: 700
    };

    if (enableReasoning) {
      // Reasoning parametry dle dokumentace OpenRouter (vÄ›tÅ¡ina modelÅ¯ to buÄ ignoruje nebo vrÃ¡tÃ­)
      payload.reasoning = {
        effort: "medium",   // low | medium | high
        exclude: false,     // false = ukaÅ¾ reasoning v odpovÄ›di, true = pouÅ¾Ã­t internÄ› (neukazovat)
        max_tokens: 500     // kolik tokenÅ¯ vÄ›novat reasoning (pokud provider podporuje)
      };
    }

    const url = "https://openrouter.ai/api/v1/chat/completions";

    const maxAttempts = 4;
    let attempt = 0;
    let delay = 800;

    while (attempt < maxAttempts) {
      attempt++;
      try {
        const resp = await fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + API_KEY
          },
          body: JSON.stringify(payload)
        });

        if (resp.ok) {
          const data = await resp.json();
          const { main, reasoning } = extractResponseParts(data);
          return { main, reasoning, raw: data };
        }

        // rate limit => zkusÃ­me retry s backoff
        if (resp.status === 429) {
          const txt = await resp.text();
          console.warn(`Attempt ${attempt} â€” rate limited (429):`, txt);
          if (attempt >= maxAttempts) {
            throw new Error("Model je momentÃ¡lnÄ› rate-limited (429). Zkus to prosÃ­m pozdÄ›ji.");
          }
          await new Promise(res => setTimeout(res, delay));
          delay *= 2;
          continue;
        }

        // invalid model (400) nebo jinÃ© chyby
        const txt = await resp.text();
        throw new Error("HTTP " + resp.status + ": " + txt);

      } catch (err) {
        console.error("Request attempt error:", err);
        if (attempt >= maxAttempts) throw err;
        await new Promise(res => setTimeout(res, delay));
        delay *= 2;
      }
    }

    throw new Error("NeznÃ¡mÃ¡ chyba pÅ™i volÃ¡nÃ­ modelu.");
  }

  // UI hooks
  document.getElementById('send').addEventListener('click', async () => {
    const inputEl = document.getElementById('input');
    const text = inputEl.value.trim();
    if (!text) return;

    // pokud uÅ¾ivatel nezadal kÃ³d, zobrazÃ­me vÃ½zvu (podle pravidel chovÃ¡nÃ­)
    if (!userContainsCode(text)) {
      appendToChat('bot', 'Ano, rÃ¡d â€” poÅ¡li prosÃ­m svÅ¯j kÃ³d v blocÃ­ch ```java``` nebo jako surovÃ½ text (pokud chceÅ¡ opravu).');
      return;
    }

    appendToChat('user', text);
    inputEl.value = '';

    // zjistit zda posÃ­lat reasoning
    const enableReasoning = document.getElementById('reasoning-checkbox').checked;

    // stavovÃ¡ zprÃ¡va
    appendToChat('bot', '<span class="small meta">...posÃ­lÃ¡m dotaz modelu...</span>');
    const statusMsg = document.querySelector('#chat .message.bot:last-child');

    try {
      const messages = buildMessages(text);
      const { main, reasoning } = await sendToOpenRouter(messages, enableReasoning);
      if (statusMsg) statusMsg.remove();
      appendToChat('bot', main);

      if (reasoning) {
        // pokud model vrÃ¡til reasoning, zobrazÃ­me ho oddÄ›lenÄ› (skrytÄ›)
        appendReasoningBlock(reasoning);
      }
    } catch (e) {
      if (statusMsg) statusMsg.remove();
      appendToChat('bot', "Chyba: " + escapeHtml(e.message));
      console.error(e);
    }
  });

  document.getElementById('input').addEventListener('keydown', (e) => { if (e.key === 'Enter') document.getElementById('send').click(); });
  document.getElementById('clear').addEventListener('click', () => { document.getElementById('chat').innerHTML = ''; });

  // â€“â€“ inicializaÄnÃ­ zprÃ¡va
  appendToChat('bot', 'Ahoj â€” jsem tvÅ¯j Java uÄitel. NapiÅ¡, s ÄÃ­m chceÅ¡ pomoci (napÅ™. "VysvÄ›tli konstruktory" nebo "Zkontroluj mÅ¯j kÃ³d").');
  </script> </body> </html> 