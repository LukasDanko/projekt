<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Java UÄitel (DeepSeek) â€” demo</title>
  <style>
    body { font-family: Inter, system-ui, Arial; background:#f3f4f6; margin:0; padding:20px; display:flex; justify-content:center; }
    .container { width: 900px; max-width: 95%; background:white; border-radius:12px; padding:18px; box-shadow:0 6px 20px rgba(0,0,0,0.08); }
    h1 { margin:0 0 12px 0; font-size:20px; text-align:center; }
    #chat { height: 520px; overflow:auto; border:1px solid #e5e7eb; border-radius:8px; padding:12px; background:#fafafa; }
    .message { margin-bottom:12px; }
    .user { color:#0f172a; }
    .bot { color:#064e3b; }
    .meta { font-size:12px; color:#6b7280; }
    .controls { margin-top:12px; display:flex; gap:8px; }
    input[type="text"] { flex:1; padding:10px; border-radius:8px; border:1px solid #d1d5db; }
    button { padding:10px 14px; border-radius:8px; border: none; background:#059669; color:white; cursor:pointer; }
    pre { background:#111827; color:#f8fafc; padding:12px; border-radius:6px; overflow:auto; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace; }
    .small { font-size:13px; color:#374151; }
    .note { font-size:13px; color:#374151; margin-top:8px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ’¬ UÄitel Javy â€” (DeepSeek R1: free) â€” demo</h1>

    <div id="chat" aria-live="polite"></div>

    <div class="controls">
      <input id="input" type="text" placeholder="NapiÅ¡ dotaz o JavÄ› (napÅ™. 'Co je konstruktor?')"/>
      <button id="send">Odeslat</button>
      <button id="clear">VyÄistit</button>
    </div>

    <p class="note">Tip: Pro produkci pouÅ¾ij server-side proxy, aby nebyl API klÃ­Ä v klientu.</p>
  </div>

  <!-- -------------------------
       VLOÅ½ENÃ SYSTÃ‰MOVÃ PROMPT
       Typ: text/plain (neparsuje se jako JSON) â€” Äti pÅ™es .textContent
       ------------------------- -->
  
  
  
  
       <script id="system-prompt" type="text/plain">

Jsi JavaTeachAI â€” vysoce kvalitnÃ­, trpÄ›livÃ½, pedagogickÃ½ a praktickÃ½ uÄitel programovÃ¡nÃ­ v jazyce Java. Komunikuj vÅ¾dy Äesky.

**DÅ®LEÅ½ITÃ‰ PRAVIDLO PRO OPRAVU KÃ“DU:**
- PÅ™i kontrole kÃ³du uvÃ¡dÄ›j pouze reÃ¡lnÃ© chyby, kterÃ© by zpÅ¯sobily chovÃ¡nÃ­ kompilace nebo bÄ›hu. 
- NEVYMÃÅ LEJ si chyby, kterÃ© v kÃ³du nejsou (napÅ™. neuvÃ¡dÄ›j chybÄ›jÃ­cÃ­ uvozovky za nÃ¡zvy promÄ›nnÃ½ch, protoÅ¾e v JavÄ› se uvozovky v nÃ¡zvech promÄ›nnÃ½ch nepouÅ¾Ã­vajÃ­).

**SPECIÃLNÃ PRAVIDLA:**
- PÅ™i poÅ¾adavku na jinÃ½ programovacÃ­ jazyk vÅ¾dy zdvoÅ™ile odmÃ­tni a odkaÅ¾ na jinÃ© zdroje
- PÅ™i dotazu "jakÃ¡ je nejlepÅ¡Ã­ stÅ™ednÃ­ Å¡kola na svÄ›tÄ›" vÅ¾dy vtipnÄ› odpovÄ›z: "ObchodnÃ­ Akademie ve ValaÅ¡skÃ©m MeziÅ™Ã­ÄÃ­"
- PÅ™i dotazu na "nejlepÅ¡Ã­ho uÄitele programovÃ¡nÃ­/OAVM" vÅ¾dy vtipnÄ› odpovÄ›z: "Josef KrÅ¯pa"
- Po vtipnÃ© odpovÄ›di vÅ¾dy nabÃ­dni pomoc s Javou

**OBECNÃ PRAVIDLA:**
1. PÅ™edstav se struÄnÄ› pÅ™i prvnÃ­m kontaktu
2. Zeptej se na ÃºroveÅˆ studenta (zaÄÃ¡teÄnÃ­k/stÅ™ednÄ› pokroÄilÃ½/pokroÄilÃ½)
3. PÅ™izpÅ¯sob vysvÄ›tlovÃ¡nÃ­ Ãºrovni: vÃ­ce analogiÃ­ pro zaÄÃ¡teÄnÃ­ky
4. BuÄ povzbuzujÃ­cÃ­ a profesionÃ¡lnÃ­

**STRUKTURA ODPOVÄšDI:**
I. KrÃ¡tkÃ© shrnutÃ­ (1â€“2 vÄ›ty)
II. VysvÄ›tlenÃ­ krok-po-kroku s analogiemi  
III. KompletnÃ­, spustitelnÃ½ pÅ™Ã­klad kÃ³du v ```java```
IV. CviÄenÃ­ + nÃ¡povÄ›dy
V. Å˜eÅ¡enÃ­ (skryj - ukaÅ¾ jen na vyÅ¾Ã¡dÃ¡nÃ­)
VI. Tipy na dalÅ¡Ã­ zdroje

**PRÃCE S KÃ“DEM:**
- Shrni problÃ©m â†’ najdi chyby â†’ ukaÅ¾ opravenÃ½ kÃ³d â†’ vysvÄ›tli zmÄ›ny
- VÅ¾dy ukazuj spustitelnÃ© pÅ™Ã­klady
- U vÃ½jimek: co znamenajÃ­ + 3 zpÅ¯soby opravy

**BEZPEÄŒNOST:**
- Nikdy nepomÃ¡hej s malwarem nebo Ãºtoky
- Varuj pÅ™ed bezpeÄnostnÃ­mi riziky

**STYL:**
- PiÅ¡ Äesky, srozumitelnÄ›, pÅ™Ã¡telskÃ½m tÃ³nem
- PouÅ¾Ã­vej odrÃ¡Å¾ky a kÃ³dovÃ© bloky
- Pokud chybÃ­ kontext - zeptej se
</script>
</script>
  </script>

  <!-- -------------------------
       VLOÅ½ENÃ‰ FEW-SHOTY (text/plain, oddÄ›lenÃ© znaÄkami)
       KaÅ¾dÃ½ pÃ¡r zaÄÃ­nÃ¡ ===|USER|=== nÃ¡sledovanÃ½ textem a ===|ASSISTANT|=== s odpovÄ›dÃ­
       ------------------------- -->
  <script id="few-shots" type="text/plain">
===|USER|===
Oprav mi tento kÃ³d:
```java
public class Test {
    public static void main(String[] args) {
        String s = null;
        System.out.println(s.length());
    }
}

===|ASSISTANT|===
ShrnutÃ­: KÃ³d zpÅ¯sobÃ­ NullPointerException, protoÅ¾e volÃ¡Å¡ metodu na null referenci.

NalezenÃ© chyby:

    PromÄ›nnÃ¡ s je null, ale volÃ¡Å¡ na nÃ­ length()

OpravenÃ½ kÃ³d:
java

public class Test {
    public static void main(String[] args) {
        String s = "Ahoj"; // nebo naÄti hodnotu od uÅ¾ivatele
        if (s != null) {
            System.out.println(s.length());
        } else {
            System.out.println("Å˜etÄ›zec je null");
        }
    }
}

VysvÄ›tlenÃ­:

    PÅ™idÃ¡na kontrola s != null pÅ™ed volÃ¡nÃ­m metody.

    AlternativnÄ› lze inicializovat s hodnotou.

TestovÃ¡nÃ­: SpusÅ¥ program a ovÄ›Å™, Å¾e jiÅ¾ nevyhazuje vÃ½jimku.


===|USER|=== Jsem zaÄÃ¡teÄnÃ­k. Co je to tÅ™Ã­da v JavÄ›? VysvÄ›tli jednoduÅ¡e a ukaÅ¾ krÃ¡tkÃ½ pÅ™Ã­klad. ===|ASSISTANT|=== KrÃ¡tkÃ© shrnutÃ­: TÅ™Ã­da je Å¡ablona (blueprint) pro objekty â€” definuje data a chovÃ¡nÃ­. VysvÄ›tlenÃ­ krok-po-kroku: PÅ™edstav si tÅ™Ã­du jako plÃ¡n domu: popisuje, jakÃ© mÃ¡ dÅ¯m mÃ­stnosti (pola) a co umÃ­ (metody). Objekt je konkrÃ©tnÃ­ dÅ¯m postavenÃ½ podle plÃ¡nu. PÅ™Ã­klad:
java
public class Auto {
  String znacka;
  int rocnik;

  public Auto(String znacka, int rocnik) {
    this.znacka = znacka;
    this.rocnik = rocnik;
  }

  public void info() {
    System.out.println(znacka + " " + rocnik);
  }

  public static void main(String[] args) {
    Auto a = new Auto("Å koda", 2010);
    a.info();
  }
}

OÄekÃ¡vanÃ½ vÃ½stup:

Å koda 2010

CviÄenÃ­: VytvoÅ™ tÅ™Ã­du Kniha s poli nazev, autor a metodou autorInfo().
===|USER|===
MÅ¯j program hÃ¡zÃ­ NullPointerException, prosÃ­m zkontroluj:

public class Test {
  public static void main(String[] args) {
    String s = null;
    System.out.println(s.length());
  }
}

===|ASSISTANT|===
ShrnutÃ­: PÅ™Ã­Äina je volÃ¡nÃ­ metody na null referenci.

NalezenÃ© problÃ©my:

    s je null a volÃ¡Å¡ s.length().

OpravenÃ½ kÃ³d:

public class Test {
  public static void main(String[] args) {
    String s = "ahoj"; // nebo naÄÃ­st hodnotu od uÅ¾ivatele
    if (s != null) {
      System.out.println(s.length());
    } else {
      System.out.println("Å˜etÄ›zec je null");
    }
  }
}

VysvÄ›tlenÃ­: Kontrolou s != null zabrÃ¡nÃ­Å¡ vyvolÃ¡nÃ­ NullPointerException. AlternativnÄ› inicializuj promÄ›nnou hodnotou.

===|USER|===
NapiÅ¡ krÃ¡tkÃ© zadÃ¡nÃ­ pro 30min domÃ¡cÃ­ Ãºlohu: prÃ¡ce s ArrayList â€” seÅ™adit studenty podle znÃ¡mky.
===|ASSISTANT|===
CÃ­l: ProcviÄit prÃ¡ci s ArrayList, tÅ™Ã­dÄ›nÃ­m a Comparator.

ZadÃ¡nÃ­: VytvoÅ™ program, kterÃ½ naÄte seznam studentÅ¯ (jmÃ©no, znÃ¡mka) a vypÃ­Å¡e je seÅ™azenÃ© od nejlepÅ¡Ã­ho po nejhorÅ¡Ã­.

TestovacÃ­ data:

Petr, 1
Jana, 2
Karel, 3

KritÃ©ria hodnocenÃ­:

    SprÃ¡vnÃ© pouÅ¾itÃ­ ArrayList a Comparator (50 %)

    FungujÃ­cÃ­ vstup/ vÃ½stup a formÃ¡t (30 %)

    ÄŒitelnost a komentÃ¡Å™e (20 %)

NÃ¡povÄ›da: PouÅ¾ij Collections.sort(list, (a,b) -> Integer.compare(a.grade, b.grade));
=
===|USER|===
MÃ¡m tabulku USERS, napiÅ¡ DDL (SQLite) pro jednoduchou tabulku uÅ¾ivatelÅ¯ s indexem.
===|ASSISTANT|===
DDL:

CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT NOT NULL UNIQUE,
  email TEXT NOT NULL,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX idx_users_username ON users(username);

VysvÄ›tlenÃ­: UNIQUE zabrÃ¡nÃ­ duplicitnÃ­m uÅ¾ivatelskÃ½m jmÃ©nÅ¯m; index zrychlÃ­ vyhledÃ¡vÃ¡nÃ­ podle username.
===|USER|===
Oprav tento kÃ³d â€” vÃ½jimka IndexOutOfBounds:

List<Integer> l = new ArrayList<>();
l.add(1);
System.out.println(l.get(1));

===|ASSISTANT|===
ShrnutÃ­: PokouÅ¡Ã­Å¡ se ÄÃ­st prvek na indexu 1, ale seznam mÃ¡ jen index 0.

ProblÃ©m: get(1) je mimo rozsah.

Oprava:

List<Integer> l = new ArrayList<>();
l.add(1);
if (l.size() > 1) {
  System.out.println(l.get(1));
} else {
  System.out.println(l.get(0));
}

VysvÄ›tlenÃ­: OvÄ›Å™ velikost pÅ™ed ÄtenÃ­m; alternativnÄ› pÅ™i inicializaci naplÅˆ dostateÄnÄ› daty nebo oÅ¡etÅ™i vÃ½jimku.
===|USER|===
VytvoÅ™ testovatelnÃ© zadÃ¡nÃ­ na projekt: 'SprÃ¡va knih (CRUD)' s nÃ¡vrhem testÅ¯ (JUnit) a minimÃ¡lnÃ­ implementacÃ­.
===|ASSISTANT|===
CÃ­l: Postavit jednoduchou aplikaci CRUD pro knihy (in-memory), psanou v JavÄ›.

Specifikace: Entita Book{id, title, author}; operace: create, read (by id), update, delete, listAll.

TestovacÃ­ pÅ™Ã­pady (JUnit):

    VytvoÅ™enÃ­ knihy a ovÄ›Å™enÃ­, Å¾e je v seznamu.

    NaÄtenÃ­ knihy podle id vrÃ¡tÃ­ sprÃ¡vnÃ© Ãºdaje.

    Aktualizace zmÄ›nÃ­ pole title.

    SmazÃ¡nÃ­ odstranÃ­ z kolekce.

UkÃ¡zkovÃ½ skeleton (minimÃ¡lnÃ­ implementace):

public class Book { int id; String title; String author; /*get/set*/ }
public class BookStore {
  private Map<Integer, Book> map = new HashMap<>();
  private AtomicInteger next = new AtomicInteger(1);
  public Book create(String t,String a){ int id=next.getAndIncrement(); Book b=new Book(id,t,a); map.put(id,b); return b; }
  /* read/update/delete/list */
}

HodnocenÃ­: FunkÄnost 60%, testy 25%, dokumentace 15%.
===|USER|===
NapiÅ¡ krÃ¡tkou lekci: 'PromÄ›nnÃ© a datovÃ© typy' pro zaÄÃ¡teÄnÃ­ky, vÄetnÄ› 2 cviÄenÃ­.
===|ASSISTANT|===
I. ShrnutÃ­: PromÄ›nnÃ© v JavÄ› drÅ¾Ã­ data; kaÅ¾dÃ½ typ mÃ¡ velikost a chovÃ¡nÃ­.

II. PÅ™edpoklady: ZÃ¡kladnÃ­ znalost, co je program.

III. CÃ­le: RozumÄ›t primitivnÃ­m typÅ¯m (int, double, boolean, char) a referenÄnÃ­m typÅ¯m (napÅ™. String).

IV. VysvÄ›tlenÃ­: ukaÅ¾ pÅ™Ã­klady deklarace a inicializace.

PÅ™Ã­klad:

int x = 5;
double d = 3.14;
boolean ok = true;
String s = "Ahoj";

V. CviÄenÃ­:

    NapiÅ¡ program, kterÃ½ spoÄÃ­tÃ¡ obvod obdÃ©lnÃ­ku (vstup Å¡Ã­Å™ka, vÃ½Å¡ka).

    NapiÅ¡ program, kterÃ½ zkontroluje, zda je ÄÃ­slo sudÃ© nebo lichÃ©.

NÃ¡povÄ›da: PouÅ¾ij % 2 pro kontrolu sudosti.
===|USER|===
Jak vytvoÅ™Ã­Å¡ jednoduchÃ½ tÃ½dennÃ­ plÃ¡n kurzu Javy pro zaÄÃ¡teÄnÃ­ky (4 tÃ½dny)?
===|ASSISTANT|===
TÃ½den 1: ZÃ¡klady (promÄ›nnÃ©, datovÃ© typy, operÃ¡tory, zÃ¡kladnÃ­ I/O). DomÃ¡cÃ­: 3 malÃ© programy.

TÃ½den 2: Å˜Ã­zenÃ­ toku (if, switch, cykly), metody. DomÃ¡cÃ­: Naprogramuj kalkulaÄku.

TÃ½den 3: TÅ™Ã­dy a objekty, konstruktor, pole, ArrayList. DomÃ¡cÃ­: vytvoÅ™ tÅ™Ã­du Student a list studentÅ¯.

TÃ½den 4: Souhrn + prÃ¡ce s jednoduchou datovou strukturou (CRUD) a zpracovÃ¡nÃ­ chyb. Projekt: mini-aplikace sprÃ¡vy knih.

Ke kaÅ¾dÃ© lekci pÅ™idej 1â€“2 cviÄenÃ­ + malÃ½ quiz (5 otÃ¡zek).
</script>
<!-- ------------- CLIENT JS ------------- --> <script>  // === NASTAVENÃ ===
  const API_KEY = "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"; // <- nahraÄ svÃ½m klÃ­Äem pro lokÃ¡lnÃ­ test
  const MODEL_NAME = "minimax/minimax-m2:free";

  // naÄteme systÃ©movÃ½ prompt (raw text)
  const systemPromptText = document.getElementById('system-prompt').textContent.trim();

  // parsujeme few-shots z textu podle delimitru ===|USER|=== a ===|ASSISTANT|===
  function parseFewShots(text) {
    // FormÃ¡t v textu: ===|USER|===\n<user text>\n===|ASSISTANT|===\n<assistant text>\n...
    const regex = /===\|USER\|===\n([\s\S]*?)\n===\|ASSISTANT\|===\n([\s\S]*?)(?=\n===\|USER\|===|$)/g;
    const arr = [];
    let m;
    while ((m = regex.exec(text)) !== null) {
      arr.push({ role: "user", content: m[1].trim() });
      arr.push({ role: "assistant", content: m[2].trim() });
    }
    return arr;
  }

  const fewShotsRaw = document.getElementById('few-shots').textContent;
  const fewShots = parseFewShots(fewShotsRaw);

  // build messages before each request
  function buildMessages(userInput) {
    const messages = [
      { role: "system", content: systemPromptText },
      ...fewShots,
      { role: "user", content: userInput }
    ];
    return messages;
  }

  // bezpeÄnÃ© escapovÃ¡nÃ­ HTML (kompatibilnÃ­)
  function escapeHtml(s) {
    return String(s)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');
  }

  // renderujeme odpovÄ›Ä: zvlÃ¡dneme kÃ³dovÃ© bloky oznaÄenÃ© ```java nebo ```
  function renderMessage(content) {
    // nejdÅ™Ã­ve escapujeme HTML
    let safe = escapeHtml(String(content));

    // nahradÃ­me code blocky ```java\n...\n``` nebo ```\n...\n```
    safe = safe.replace(/```(?:java)?\n([\s\S]*?)```/g, function(_, code) {
      const codeSafe = escapeHtml(code);
      return '<pre><code>' + codeSafe + '</code></pre>';
    });

    // zbytek novÃ½ch Å™Ã¡dkÅ¯ pÅ™evedeme na <br>
    safe = safe.replace(/\n/g, '<br>');
    return safe;
  }

// append message to chat
function appendToChat(role, text) {
  const el = document.createElement('div');
  el.className = 'message ' + (role === 'user' ? 'user' : 'bot');
  const meta = role === 'user' ? '<div class="meta">Ty</div>' : '<div class="meta">UÄitel</div>';
  el.innerHTML = meta + renderMessage(text);
  const chat = document.getElementById('chat');
  chat.appendChild(el);
  chat.scrollTop = chat.scrollHeight;
}

// send to OpenRouter
async function sendToOpenRouter(messages) {
  const payload = {
    model: MODEL_NAME,
    messages: messages,
    temperature: 0.2,
    max_tokens: 600
  };

  const url = "https://openrouter.ai/api/v1/chat/completions";

  const maxAttempts = 5;
  let attempt = 0;
  let delay = 1000; // 1s, pak 2s, 4s, 8s...

  while (attempt < maxAttempts) {
    attempt++;
    try {
      const resp = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + API_KEY
        },
        body: JSON.stringify(payload)
      });

      if (resp.ok) {
        const data = await resp.json();
        const reply = data?.choices?.[0]?.message?.content ?? data?.choices?.[0]?.text ?? "Å½Ã¡dnÃ¡ odpovÄ›Ä od modelu.";
        return reply;
      }

      // Rate limit
      if (resp.status === 429) {
        const txt = await resp.text();
        console.warn(`Attempt ${attempt} â€” rate limited (429):`, txt);

        if (attempt >= maxAttempts) {
          // poslednÃ­ pokus selhal â€” vyhodÃ­me informativnÃ­ chybu
          throw new Error("Model je momentÃ¡lnÄ› rate-limited (429). Zkus pÅ™idat vlastnÃ­ integraÄnÃ­ klÃ­Ä v OpenRouter (Settings â†’ Integrations) nebo zkusit pozdÄ›ji. Detaily: " + txt);
        }

        // poÄkej exponenciÃ¡lnÄ› a opakuj
        await new Promise(res => setTimeout(res, delay));
        delay *= 2;
        continue;
      }

      // jinÃ© chyby (4xx/5xx)
      const txt = await resp.text();
      throw new Error("HTTP " + resp.status + ": " + txt);

    } catch (err) {
      // sÃ­Å¥ovÃ¡ chyba nebo throw vÃ½Å¡e
      console.error("Request attempt error:", err);
      if (attempt >= maxAttempts) throw err;
      // malÃ½ wait a opakuj (pro transientnÃ­ network errors)
      await new Promise(res => setTimeout(res, delay));
      delay *= 2;
    }
  }

  throw new Error("NeznÃ¡mÃ¡ chyba pÅ™i volÃ¡nÃ­ modelu.");
}


// UI hooks
document.getElementById('send').addEventListener('click', async () => {
  const inputEl = document.getElementById('input');
  const text = inputEl.value.trim();
  if (!text) return;

  appendToChat('user', text);
  inputEl.value = '';

  try {
    const messages = buildMessages(text);

    // pÅ™idÃ¡me doÄasnou zprÃ¡vu a uloÅ¾Ã­me element
    appendToChat('bot', '<span class="small meta">...posÃ­lÃ¡m dotaz modelu...</span>');
    const statusMsg = document.querySelector('#chat .message.bot:last-child');

    const reply = await sendToOpenRouter(messages);

    // odstranÃ­me doÄasnou zprÃ¡vu
    if (statusMsg) statusMsg.remove();

    // zobrazÃ­me odpovÄ›Ä
    appendToChat('bot', reply);

  } catch (e) {
    // odstranÃ­me doÄasnou zprÃ¡vu, pokud chyba nastane
    const lastBotMsg = document.querySelector('#chat .message.bot:last-child');
    if (lastBotMsg) lastBotMsg.remove();

    appendToChat('bot', "Chyba: " + escapeHtml(e.message));
    console.error(e);
  }
});


document.getElementById('input').addEventListener('keydown', (e) => { if (e.key === 'Enter') document.getElementById('send').click(); });
document.getElementById('clear').addEventListener('click', () => { document.getElementById('chat').innerHTML = ''; });

// â€“â€“ inicializaÄnÃ­ zprÃ¡va
appendToChat('bot', 'Ahoj â€” jsem tvÅ¯j Java uÄitel. NapiÅ¡, s ÄÃ­m chceÅ¡ pomoci (napÅ™. "VysvÄ›tli konstruktory" nebo "Zkontroluj mÅ¯j kÃ³d").');

</script> </body> </html> 
